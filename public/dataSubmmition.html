<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Read CSV File</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script type="text/javascript" src="js/codeDataInsert.js"></script>
    <script type="text/javascript" src="js/codeGraphicsGen.js"></script>
    <script type="text/javascript" src="js/codeDataLoad.js"></script>
    <script type="text/javascript" src="js/jsonNames.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

</head>
</head>

<body>
    <button style="font-size: larger;" onclick="toMainPage()">חזור להצגת נתונים </button>
    <br></br>
    <!-- <button onclick="readCSV(processData)">Read CSV</button> -->
    <!-- <button onclick="readCSV(previewData)">preview CSV</button> -->
    <input type="text" id="passwordInput" placeholder="סיסמה" />
    <br>
    <button onclick="createProject()">צור פרויייקט</button>
    <input type="text" id="projectnameInput" placeholder="בחר שם לפרוייקט חדש" />
    <input type="number" id="startyearInput" placeholder="שנת התחלה" />
    <input type="number" id="endyearInput" placeholder="שנת סיום" />
    <br>
    <input type="text" id="projectnameSelector" placeholder="שם פרוייקט" />
    <input type="text" id="supermeasureSelector" placeholder="שם מדד" />
    <input type="number" id="yearSelector" placeholder="שנה"></input>
    <input type="number" id="number_of_rowsInput" placeholder="כמה שורות לקרוא?" />
    <table style="border: 1px solid black;">
        <tr class="centered" style="border: 1px solid black;">
            <td style="border: 1px solid black;">
                <input type="file"   width: 1px;" id="FileInput" accept=".xlsx">
            <td style="border: 1px solid black;"> <button onclick="readCSV(resourceNaming)">הכנסת מידע</button> משאב
                תכנון ופיתוח</td>
        </tr>

    </table>
    <br></br>
    <div id="previewGraphicsContainer"></div>

</body>
<script>
    var selected_region = 0;

    function toMainPage() {
        // Replace 'target.html' with the actual file name or path of the HTML page you want to redirect to
        window.location.href = 'index.html';
    }
    function createProject() {
        const startyear = document.getElementById("startyearInput").value;
        const  project= document.getElementById("projectnameInput").value;
        const endyear = document.getElementById("endyearInput").value;
        const password = document.getElementById("passwordInput").value;
        console.log('create project',startyear,endyear,project,password);
        if(password==''){
            alert("לא הוכנסה סיסמה");
            return ;
        }
        if(startyear==''){
            alert("לא הוכנסה שנת תחילה");
            return ;
        } 
        if(endyear==''){
            alert("לא הוכנסה שנת סיום");
            return ;
        }
        if(endyear<startyear){
            alert("שנת סיום לפני שנת התחלה");
            return;
        }
        fetch(`/api/createProject/project/${project}/startyear/${startyear}/endyear/${endyear}` ,{ "method": 'POST', "body": JSON.stringify({"pass":password}), "headers": { 'Content-Type': 'application/json', } })
        .then(response => {
            console.log("resposnse",response);
            if(!response.ok){
                console.log(response.status);
                if(response.status==409){
                    alert("פרוייקט בעל שם זה כבר קיים. ניתן לבחור שם אחר\n"+"אם שם אחר לא מתאים מומלץ להוסיף את שנת ההתחלה לשם");
                }else{
                    alert("שגיאה\n"+response.status+"\n"+response.statusText);
                }
            }
            else{
                alert("פרוייקט נוצר בהצלחה");
            }
        }).catch(err=>{
            console.log(err)
        });
    }
    
</script>


</html>