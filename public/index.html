
<!DOCTYPE html>
<html>
    <meta charset="UTF-8">
        <link rel="stylesheet" href="style.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <script type="text/javascript" src="js/codeDataLoad.js"></script>
    <script type="text/javascript" src="js/codeGraphicsGen.js"></script>

    <body>
        <h2>WIP</h2>
        <h2 id="loading" class="loading" style="display: none; align-self: center;"></h2>
        <button onclick="redirectToSubmit()" class="selector">לעומד הכנסת מידע</button>
        <div id='checkbox-container' class="checkbox_container" style="margin-bottom: 2%;padding-bottom:20px ;"></div>
        <div id="graphicsContainer" class="centered"></div>

    </body>
</html>
<script>
    function loadingPopup(txt,timeout_ms){
        const l=document.getElementById("loading");
        l.textContent=txt
        l.style.display='flex';
        setTimeout(()=> {l.style.display='none';},timeout_ms);
    }
    function redirectToSubmit() {
      // Replace 'target.html' with the actual file name or path of the HTML page you want to redirect to
      window.location.href = 'dataSubmmition.html';
    }
    function updateFilterDisplays(from_group){
        const selectedProvinces = [];
        const checkboxes = document.querySelectorAll(`.${from_group} input[type="checkbox"]:checked`);

        checkboxes.forEach(checkbox => selectedProvinces.push(checkbox.id));
        
        const displays=Array.from(document.getElementsByClassName("displayFilter"));

        displays.forEach(element=>{
            element.textContent= selectedProvinces.length>0 ?"רשויות: "+selectedProvinces.join(", ") :"" ;
        });
        console.log("slected names",selectedProvinces.join(","));

    }
    function updateSelectedCheckboxes(group) {
        const selectedCheckboxes = [];
        const checkboxes = document.querySelectorAll(`.${group} input[type="checkbox"]:checked`);

        checkboxes.forEach(checkbox => {
            selectedCheckboxes.push(checkbox.value);
        });
        
        sortedIDs=selectedCheckboxes.sort((a, b) => a - b);
        
        console.log(sortedIDs);
        
        return sortedIDs;

    }
    function createCheckboxes(names,group,func) {
        const checkboxContainer = document.getElementById('checkbox-container');
        checkboxContainer.classList.add(group);
        console.log("names",names);
        for (let i=0;i<names.length;i++){
            const name =names[i];
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = i;
            checkbox.id = name;
            checkbox.checked=true;
            checkbox.classList.add("checkbox");
            

            const label = document.createElement('label');
            label.htmlFor = name;
            label.appendChild(document.createTextNode(name));
            const inputContainter=document.createElement('c');
            inputContainter.appendChild(checkbox);
            inputContainter.appendChild(label);
            checkboxContainer.appendChild(inputContainter);
            

            // Attach change event listener to each checkbox
            checkbox.addEventListener('change', func);
        }
    }

</script>


<script>
    
    const graphicsContainer=document.getElementById("graphicsContainer");
    // Your client-side JavaScript code here
    fetch('/api/getData')
    .then(response => response.json())
    .then(data => {
        jd=covertTableToJson(data);
        let provinces_names=jd[0].res_profline.provinces_names;
        createCheckboxes(provinces_names,"provinces",()=>{
            const slectedIDs= updateSelectedCheckboxes("provinces");
            const newData= sortedIDs.map(ID=>data[ID]);
            // if(newData.length>2){
                generateGraphicsFor(graphicsContainer,covertTableToJson(newData),0,()=>updateFilterDisplays("provinces"));
                
            // }
            // else{
            //     loadingPopup('פחות מדי נבחרו ',1500);

            // }


        });
        generateGraphicsFor(graphicsContainer,jd,0,()=>updateFilterDisplays("provinces"));
    })
    .catch(error => console.error('Error fetching data:', error));

</script>
